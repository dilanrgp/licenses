<div id="modal-license" class="modal">
        <app-toast-message/>
        @if(loading()){
        <div class="overlay">
                <span class="loading loading-spinner text-secondary"></span>
        </div>
        }
        <div class="modal-box max-w-7xl">
                <button type="button" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2" (click)="onClose()">✕</button>
                @if (licenseData(); as license) {
			<div class="flex justify-between items-start mt-5">
				<div>
					<h3 class="text-lg font-bold">{{ 'license.modal.title' | changeLanguage }}</h3>
					<div class="text-xs font-semibold opacity-60">
						{{ license.po | orderPosition: license.position}}

					</div>
				</div>
				<div class="flex gap-1">
					@if (license.license_status_id <= 2){ 
						<button class="btn btn-xs btn-success rounded-sm" (click)="sendMail()" [disabled]="license.license_status_id > 2">{{ textButtonSend() | changeLanguage }}</button>
					}
					<!--  -->
					@if (license.license_status_id == 1){
						<button class="btn btn-xs btn-error rounded-sm" [disabled]="license.license_status_id > 3">{{ 'common.delete_license' | changeLanguage }}</button>
					}
				</div>
			</div>

		<!-- TODO: QUITAR AL PASAR A PRODUCCION -->
		@if (license.license_status_id > 1){
		<div role="alert" class="alert alert-warning animate-fade-in">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none"
				viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
					d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
			</svg>
			<span>Esto solo es para el ambiente de desarrollo</span>
			<p><a target="_blank" class="link link-accent"
					[href]="`http://localhost:4200/conditions/${license.client_token}`">Enlace correo cliente</a></p>
		</div>
		}
		<!-- TODO: QUITAR AL PASAR A PRODUCCION -->

		<!-- Sección de detalles -->
		<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-5">
			<!-- Columna izquierda - Información básica -->
			<div class="space-y-4">
				<!-- Tarjeta de información general -->
				<div class="card bg-primary/10 shadow-sm">
					<div class="card-body p-4">
						<div class="flex justify-between items-start">
							<h4 class="card-title text-lg font-semibold text-gray-700 mb-3">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
									<g fill="none" stroke="currentColor" stroke-width="1.5">
										<circle cx="12" cy="6" r="4" />
										<path stroke-linecap="round"
											d="M19.998 18q.002-.246.002-.5c0-2.485-3.582-4.5-8-4.5s-8 2.015-8 4.5S4 22 12 22c2.231 0 3.84-.157 5-.437" />
									</g>
								</svg>
								{{ 'license.modal.general_information' | changeLanguage}}
							</h4>
							<div class="badge badge-primary  rounded-md">
								{{ license.license_status_name }}
							</div>

						</div>
						<div class="space-y-2">
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'common.client' | changeLanguage | titlecase}}:</span>
								<span class="font-medium">{{ license.client_email }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.po_position' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.po }} | {{ license.position }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.order' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.custorder }}</span>
							</div>
						</div>
					</div>
				</div>

				<!-- Tarjeta de estado -->
				<div class="card bg-primary/10 shadow-sm">
					<div class="card-body p-4">
						<h4 class="card-title text-lg font-semibold text-gray-700 mb-3">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
								<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5">
									<path stroke-linejoin="round"
										d="M2 5.5L3.214 7L7.5 3M2 12.5L3.214 14L7.5 10M2 19.5L3.214 21L7.5 17" />
									<path d="M22 12h-5m-5 0h1.5M12 19h5m3.5 0H22m0-14H12" />
								</g>
							</svg>
							{{ 'license.modal.tracking' | changeLanguage}}

						</h4>
						<div class="grid grid-cols-4 gap-1">
							<div class="flex col-span-4">
								<span class="text-gray-500 mr-2">{{ 'license.modal.mail_sent' | changeLanguage }}:</span>
								@if (license.sent) {
								{{ license.sent_date | date:'medium' }}
								} @else {
								<span class="badge badge-error">{{ 'common.not' | changeLanguage }}</span>
								}
							</div>
							@if (license.accept_conditions) {
							<div class="flex items-center col-span-2">
								<span class="text-gray-500 mr-2">{{ 'license.modal.accept_terms' | changeLanguage }}</span>
								{{ license.accept_conditions_date | date:'medium' }}
							</div>
							<div class="flex items-center">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
									<path fill="currentColor"
										d="M21 16.83v-5.667c0-1.044 0-1.566-.283-1.959c-.229-.317-.596-.486-1.25-.713c-.134 1.606-.666 3.247-1.501 4.682c-.973 1.672-2.418 3.167-4.269 3.974a4.26 4.26 0 0 1-3.394 0c-1.851-.807-3.296-2.302-4.269-3.974A11.5 11.5 0 0 1 4.7 9.658c-.383-.057-.676-.028-.93.113a1.5 1.5 0 0 0-.28.203C3 10.42 3 11.249 3 12.908v4.93c0 1.043 0 1.565.283 1.958s.778.558 1.768.888l.384.128c1.577.525 2.365.788 3.172.79q.364 0 .726-.052c.798-.115 1.548-.49 3.048-1.24c1.149-.575 1.724-.862 2.334-.995q.321-.07.65-.098c.623-.052 1.25.053 2.507.262c1.273.212 1.91.318 2.375.051q.239-.137.413-.35c.34-.415.34-1.06.34-2.35" />
									<path fill="currentColor" fill-rule="evenodd"
										d="M12 2C8.686 2 6 4.552 6 7.7c0 3.124 1.915 6.769 4.903 8.072a2.76 2.76 0 0 0 2.194 0C16.085 14.47 18 10.824 18 7.7C18 4.552 15.314 2 12 2m0 8a2 2 0 1 0 0-4a2 2 0 0 0 0 4"
										clip-rule="evenodd" />
								</svg>
								{{ license.accept_conditions_ip }}
							</div>
							<div class="flex items-center">
								<div class="tooltip" [attr.data-tip]="'license.modal.see_terms' | changeLanguage">
									<a [href]="license!.license_terms_file" target="_blank" class="btn btn-xs btn-square btn-ghost">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
										<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M8 12h1m7 0h-4m4-4h-1m-3 0H8m0 8h5M3 14v-4c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h2c3.771 0 5.657 0 6.828 1.172c.654.653.943 1.528 1.07 2.828M21 10v4c0 3.771 0 5.657-1.172 6.828S16.771 22 13 22h-2c-3.771 0-5.657 0-6.828-1.172c-.654-.653-.943-1.528-1.07-2.828" />
									</svg>
									</a>
									<a class="link link-hover" [href]="license!.license_terms_file" target="_blank">
										{{ 'license.modal.see_terms' | changeLanguage }}
									</a>
								</div>
							</div>
							}
							<!--  -->
							@else {
							<div class="col-span-4">
								<span class="text-gray-500 mr-2">{{ 'license.modal.accept_terms' | changeLanguage }}:</span>
								<span class="badge badge-error">{{ 'common.not' | changeLanguage }}</span>
							</div>
							}
						</div>
					</div>
				</div>
			</div>

			<!-- Columna derecha - Información de licencia -->
			<div class="space-y-4">
				<!-- Tarjeta de identificación -->
				<div class="card bg-primary/10 shadow-sm">
					<div class="card-body p-4">
						<h4 class="card-title text-lg font-semibold text-gray-700 mb-3">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
								<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5">
									<path stroke-linejoin="round" d="m9.5 12.4l1.429 1.6l3.571-4" />
									<path
										d="M3 10.417c0-3.198 0-4.797.378-5.335c.377-.537 1.88-1.052 4.887-2.081l.573-.196C10.405 2.268 11.188 2 12 2s1.595.268 3.162.805l.573.196c3.007 1.029 4.51 1.544 4.887 2.081C21 5.62 21 7.22 21 10.417v1.574c0 2.505-.837 4.437-2 5.913M3.193 14c.857 4.298 4.383 6.513 6.706 7.527c.721.315 1.082.473 2.101.473c1.02 0 1.38-.158 2.101-.473c.579-.252 1.231-.58 1.899-.994" />
								</g>
							</svg>
							{{ 'license.name' | changeLanguage}}
						</h4>
						<div class="space-y-2">
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.material' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.material }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.part_number' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.idmaterial }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.serial_number' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.serial_number }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.license_code' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.pin_code }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.number_of_licensed' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.quantity }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.type' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.type }}</span>
							</div>
							<div class="flex justify-between">
								<span class="text-gray-500">{{ 'license.modal.bundle' | changeLanguage }}:</span>
								<span class="font-medium">{{ license.bundle }}</span>
							</div>
						</div>
					</div>
				</div>

				@if(licenseFiles().length > 0){

				<!-- Tarjeta de fechas -->
				<div class="card bg-primary/10 shadow-sm">
					<div class="card-body p-4">
						<h4 class="card-title text-lg font-semibold text-gray-700 mb-3">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
								<g fill="none" stroke="currentColor" stroke-width="1.5">
									<path stroke-linecap="round"
										d="M3 14v-4c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h2c3.771 0 5.657 0 6.828 1.172c.654.653.943 1.528 1.07 2.828M21 10v4c0 3.771 0 5.657-1.172 6.828S16.771 22 13 22h-2c-3.771 0-5.657 0-6.828-1.172c-.654-.653-.943-1.528-1.07-2.828" />
									<path stroke-linecap="round"
										d="M9.5 15.5v-.125c0-.483.392-.875.875-.875h3.25c.483 0 .875.392.875.875v.125a2.5 2.5 0 0 1-5 0Z" />
									<path
										d="M9.5 3c0-.471 0-.707.146-.854C9.793 2 10.03 2 10.5 2h.5c.471 0 .707 0 .854.146C12 2.293 12 2.53 12 3v.5c0 .471 0 .707-.146.854c-.147.146-.383.146-.854.146h-.5c-.471 0-.707 0-.854-.146C9.5 4.207 9.5 3.97 9.5 3.5zm0 5c0-.471 0-.707.146-.854C9.793 7 10.03 7 10.5 7h.5c.471 0 .707 0 .854.146C12 7.293 12 7.53 12 8v.5c0 .471 0 .707-.146.854c-.147.146-.383.146-.854.146h-.5c-.471 0-.707 0-.854-.146C9.5 9.207 9.5 8.97 9.5 8.5zM12 5.5c0-.471 0-.707.146-.854c.147-.146.383-.146.854-.146h.5c.471 0 .707 0 .854.146c.146.147.146.383.146.854V6c0 .471 0 .707-.146.854C14.207 7 13.97 7 13.5 7H13c-.471 0-.707 0-.854-.146C12 6.707 12 6.47 12 6zm0 5c0-.471 0-.707.146-.854c.147-.146.383-.146.854-.146h.5c.471 0 .707 0 .854.146c.146.147.146.383.146.854v.5c0 .471 0 .707-.146.854c-.147.146-.383.146-.854.146H13c-.471 0-.707 0-.854-.146C12 11.707 12 11.47 12 11z" />
								</g>
							</svg>
							{{ 'license.files' | changeLanguage}}

						</h4>
						<div class="space-y-2">
							<ul class="list bg-base-100 rounded-box shadow-md">
								@for (file of licenseFiles(); track $index) {
								<li class="list-row">
									<div>
										<div>{{file.filename}}</div>
									</div>
									<div></div>
									<div>
										@if (file.downloaded) {
										<span>{{ 'license.modal.downloaded' | changeLanguage }}:</span>
										{{ file.download_date| date:'medium' }}
										} @else {
										<span class="badge badge-warning">{{ 'license.modal.pending_download' | changeLanguage }}</span>
										}
									</div>
								</li>
								}
							</ul>
						</div>
					</div>
				</div>
				}
			</div>
		</div>
		}
	</div>

</div>
